$schema: "http://json-schema.org/draft-07/schema#"
$author: "Francis Charette-Migneault <francis.charette-migneault@crim.ca>"
$id: "https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-dru/cwl.yaml"

$defs:
  DeployCWL:
    oneOf:
      - $ref: "#/$defs/CWL"
      - $ref: "#/$defs/DeployOGCAppPackageCWL"
  DeployOGCAppPackageCWL:
    type: object
    title: DeployOGCAppPackage
    description: Deployment using standard OGC Application Package definition.
    properties:
      processDescription:
        $ref: "https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/process.yaml"
      immediateDeployment:
        type: boolean
        title: immediateDeployment
        default: true
      deploymentProfileName:
        type: string
        format: uri
        enum:
        # if the CWL has a DockerRequirement and is a 'class: CommandLineTool'
        - "http://www.opengis.net/profiles/eoc/dockerizedApplication"
        # when the CWL is a 'class: Workflow'
        - "http://www.opengis.net/profiles/eoc/workflow"
      executionUnit:
        oneOf:
          - $ref: "#/$defs/CWLExecutionUnit"
          - type: array
            items:
              $ref: "#/$defs/CWLExecutionUnit"
    required:
      - executionUnit
      - processDescription
    additionalProperties: false
  CWLExecutionUnit:
    description: CWL definition use to deploy a process.
    oneOf:
    - type: object
      properties:
        unit:
          $ref: '#/$defs/CWL'
    - type: object
      properties:
        href:
          $comment: |
            Different media-types are available (application/cwl, application/cwl+json, application/cwl+yaml).
            See 'https://github.com/common-workflow-language/common-workflow-language/issues/421' for media-types.
          oneOf:
            - type: string
              format: uri
              pattern: '^.*\.cwl(#[A-Za-z0-9\/_.-]+)?$'
              contentMediaType: application/cwl
              contentSchema: 'https://raw.githubusercontent.com/common-workflow-language/cwl-v1.2/1.2.1_proposed/json-schema/cwl.yaml#/$defs/CWL'
            - type: string
              format: uri
              pattern: '^.*\.json(#[A-Za-z0-9\/_.-]+)?$'
              contentMediaType: application/cwl+json
              contentSchema: 'https://raw.githubusercontent.com/common-workflow-language/cwl-v1.2/1.2.1_proposed/json-schema/cwl.yaml#/$defs/CWL'
            - type: string
              format: uri
              pattern: '^.*\.ya?ml(#[A-Za-z0-9\/_.-]+)?$'
              contentMediaType: application/cwl+yaml
              contentSchema: 'https://raw.githubusercontent.com/common-workflow-language/cwl-v1.2/1.2.1_proposed/json-schema/cwl.yaml#/$defs/CWL'
  CWL:
    $ref: 'https://raw.githubusercontent.com/common-workflow-language/cwl-v1.2/1.2.1_proposed/json-schema/cwl.yaml#/$defs/CWL'
